# –†–µ—Ñ—Ä–∞–∫—Ç–æ—Ä–∏–Ω–≥ Onboarding-—Ñ–ª–æ—É: –ë–∞–∑–∞ –≤ –Ω–∞—á–∞–ª–µ (Base-First)

–ü–µ—Ä–µ–Ω–æ—Å —ç—Ç–∞–ø–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –ë–∞–∑—ã (—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Å–∏—Å—Ç–µ–º—ã) –≤ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–∏—Å—Ç–µ–º–æ–π. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∞–Ω–∫–µ—Ç–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–Ω—è—Ç–∏—è –ë–∞–∑—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (Prisma)
- –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å [User](file:///f:/Matrix_Gin/backend/src/services/telegram.service.ts#761-767):
  - `baseAccepted`: Boolean (default: false)
  - `baseAcceptedAt`: DateTime?
  - `baseVersion`: String?
- –û–±–Ω–æ–≤–∏—Ç—å enum [RegistrationStep](file:///f:/Matrix_Gin/backend/src/services/employee-registration.service.ts#200-244):
  - –î–æ–±–∞–≤–∏—Ç—å `BASE` –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥.

### 2. –ë—ç–∫–µ–Ω–¥: Telegram –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- **EmployeeRegistrationService**:
  - –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–π —à–∞–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å `PHOTO` –Ω–∞ `BASE`.
  - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–ª–æ–∫–æ–≤ –ë–∞–∑—ã –≤ —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
  - –ú–µ—Ç–æ–¥ [handleRegistrationStep](file:///f:/Matrix_Gin/backend/src/services/employee-registration.service.ts#200-244) –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ `PHOTO` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `accept_foundation`.
- **FoundationService**:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ë–∞–∑—ã.
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—è—Ç–∏–µ –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ Audit Log.

### 3. –ë—ç–∫–µ–Ω–¥: API –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/onboarding/accept-base` –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
- –û–±–Ω–æ–≤–∏—Ç—å Middleware: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ `baseAccepted = true` –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø –∫ —Ä–æ—É—Ç–∞–º –ë–∞–∑—ã).

### 4. –§—Ä–æ–Ω—Ç–µ–Ω–¥
- **FoundationGuard**: –ñ–µ—Å—Ç–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤ (–∫—Ä–æ–º–µ `/foundation` –∏ `/login`), –µ—Å–ª–∏ `baseAccepted === false`.
- **LoginPage**: –ö–Ω–æ–ø–∫–∞ "üß≠ –£–∑–Ω–∞–π –ë–∞–∑—É" –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.
- **Onboarding Flow**: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ –ø—Ä–∏–Ω—è–ª –ë–∞–∑—É ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/foundation/start`.

---

## –ü–ª–∞–Ω –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ú–æ–¥–µ–ª–∏
1. [MODIFY] [schema.prisma](file:///f:/Matrix_Gin/backend/prisma/schema.prisma): –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ [User](file:///f:/Matrix_Gin/backend/src/services/telegram.service.ts#761-767) –∏ –∑–Ω–∞—á–µ–Ω–∏—è `BASE` –≤ [RegistrationStep](file:///f:/Matrix_Gin/backend/src/services/employee-registration.service.ts#200-244).
2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

### –≠—Ç–∞–ø 2: –ë—ç–∫–µ–Ω–¥ (–õ–æ–≥–∏–∫–∞ Onboarding)
1. [MODIFY] [foundation.service.ts](file:///f:/Matrix_Gin/backend/src/services/foundation.service.ts): –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ [User](file:///f:/Matrix_Gin/backend/src/services/telegram.service.ts#761-767).
2. [MODIFY] [employee-registration.service.ts](file:///f:/Matrix_Gin/backend/src/services/employee-registration.service.ts): –ø–µ—Ä–µ–Ω–æ—Å —à–∞–≥–∞ `BASE` –≤ –Ω–∞—á–∞–ª–æ —Ñ–ª–æ—É. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
3. [MODIFY] [telegram.service.ts](file:///f:/Matrix_Gin/backend/src/services/telegram.service.ts): –∞–¥–∞–ø—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–ª–±—ç–∫–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### –≠—Ç–∞–ø 3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –ì–µ–π—Ç—ã
1. [MODIFY] [App.tsx](file:///f:/Matrix_Gin/frontend/src/App.tsx) –∏ [FoundationGuard.tsx](file:///f:/Matrix_Gin/frontend/src/components/auth/FoundationGuard.tsx): —É—Å–∏–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫.
2. [MODIFY] [LoginPage.tsx](file:///f:/Matrix_Gin/frontend/src/pages/LoginPage.tsx): –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó.

### –≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
- [ ] `README.md`
- [ ] [ARCHITECTURE.md](file:///f:/Matrix_Gin/MENU_ARCHITECTURE.md)
- [ ] `SECURITY-ARCHITECTURE.md`
- [ ] `MASTER_PLAN.md`
- [ ] `MASTER_CHECKLIST.md`

---

## –ü–ª–∞–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–¢–ì –ë–æ—Ç**: –ù–æ–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ -> –ù–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å" -> –î–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å—Å—è –ø–æ–∫–∞–∑ –ë–∞–∑—ã, –∞ –Ω–µ –∑–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ.
2. **–¢–ì –ë–æ—Ç**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –ë–∞–∑—É -> –¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –∑–∞–ø—Ä–æ—Å "–®–∞–≥ 1/11: –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è".
3. **Web**: –õ–æ–≥–∏–Ω –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –Ω–µ –ø—Ä–∏–Ω—è–≤—à–∏–º –±–∞–∑—É -> –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —ç–∫—Ä–∞–Ω –ë–∞–∑—ã. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–π—Ç–∏ –Ω–∞ `/dashboard` –≤—Ä—É—á–Ω—É—é –¥–æ–ª–∂–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- `npm run test` (backend)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/api/onboarding/accept-base`

---
id: BUSINESS_LOGIC_001
type: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è_–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
role: –°—Ö–µ–º–∞_–î–∞–Ω–Ω—ã—Ö
version: 1.0
date: 2025-12-27
status: –î–µ–π—Å—Ç–≤—É—é—â–∏–π
links:
  - file: ../../../memory-bank/üìã_–ú–ê–°–¢–ï–†-–†–ï–ì–õ–ê–ú–ï–ù–¢_–°–æ–∑–¥–∞–Ω–∏—è_–î–æ–∫—É–º–µ–Ω—Ç–æ–≤_–§–æ—Ç–æ–º–∞—Ç—Ä–∏—Ü–∞.md
    type: master_regulation
  - file: ./üìã_–û–ø–∏—Å–∞–Ω–∏–µ_–ë–∏–∑–Ω–µ—Å–∞_–§–æ—Ç–æ–º–∞—Ç—Ä–∏—Ü—ã.md
    type: related_document
  - file: ./üí∞_–°–∏—Å—Ç–µ–º–∞_–ú–æ—Ç–∏–≤–∞—Ü–∏–∏_–§–æ—Ç–æ–º–∞—Ç—Ä–∏—Ü—ã.md
    type: related_document
---

# üîß –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê –§–û–¢–û–ú–ê–¢–†–ò–¶–´

## –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—É—â–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

---

## üéØ –¶–ï–õ–¨ –î–û–ö–£–ú–ï–ù–¢–ê

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–∏–¥–µ–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö** –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ, –∞ –Ω–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–∏–º–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ KPI –∏ –ó–ü.

---

## 1. –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ò–î–ï–Ø –°–•–ï–ú–´

> üî• **–í—Å—ë —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–æ–∫—Ä—É–≥ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ ‚Äî ¬´–ö–æ–º–ø–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π¬ª**

–ù–∞–∑–æ–≤—ë–º –µ—ë: **PHOTO_COMPANY** (–∏–ª–∏ SESSION / COMPANY)

–≠—Ç–æ **–µ–¥–∏–Ω—ã–π –æ–±—ä–µ–∫—Ç**, –∫–æ—Ç–æ—Ä—ã–π:
- –°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–º
- –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
- –ü–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∂—É
- –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–µ–Ω—å–≥–∏
- –ö–æ—Ä–º–∏—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é –≤—Å–µ—Ö —Ä–æ–ª–µ–π

---

## 2. –°–ü–ò–°–û–ö –°–£–©–ù–û–°–¢–ï–ô

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:

1. **Employee** ‚Äî —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
2. **Location** ‚Äî –ª–æ–∫–∞—Ü–∏–∏ (–ø–∞—Ä–∫, –∑–æ–æ–ø–∞—Ä–∫, –∞–∫–≤–∞–ø–∞—Ä–∫)
3. **Shift** ‚Äî —Å–º–µ–Ω—ã
4. **PhotoCompany** ‚Äî –∫–æ–º–ø–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π (–∫–ª—é—á–µ–≤–∞—è)
5. **Photo** ‚Äî –∫–∞–¥—Ä—ã
6. **ProductionBatch** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ / –ø–µ—á–∞—Ç—å
7. **Product** ‚Äî –ø—Ä–æ–¥—É–∫—Ü–∏—è (—Ä–∞–º–∫–∞, –º–∞–≥–Ω–∏—Ç –∏ —Ç.–ø.)
8. **Sale** ‚Äî –ø—Ä–æ–¥–∞–∂–∞
9. **SaleItem** ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –≤ —á–µ–∫–µ
10. **Feedback** ‚Äî —Ñ–∏–¥–±—ç–∫–∏
11. **PayrollCalc** ‚Äî —Ä–∞—Å—á—ë—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏

---

## 3. –°–£–©–ù–û–°–¢–ò –ò –ü–û–õ–Ø

### 3.1. Employee (–°–æ—Ç—Ä—É–¥–Ω–∏–∫)

```
Employee
- id
- full_name
- role (photographer, retoucher, seller, assistant, admin)
- location_id
- is_active
- hire_date
```

üîó –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ

üí° –û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–∑–∂–µ)

---

### 3.2. Location (–õ–æ–∫–∞—Ü–∏—è)

```
Location
- id
- name
- city
- type (zoo, park, aquapark)
- is_active
```

---

### 3.3. Shift (–°–º–µ–Ω–∞)

```
Shift
- id
- date
- location_id
- employee_id
- role
- start_time
- end_time
```

üìå –ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –°—á–∏—Ç–∞—Ç—å –≤—ã—Ä–∞–±–æ—Ç–∫—É
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –î–µ–ª–∞—Ç—å –æ—Ç—á—ë—Ç—ã –ø–æ —Å–º–µ–Ω–∞–º

---

### 3.4. PhotoCompany (–ö–æ–º–ø–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π) ‚≠ê

**–°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã**

```
PhotoCompany
- id (QR / –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥)
- date_time
- location_id
- photographer_id
- status (shot, retouched, printed, on_sale, sold, declined)
- photos_count
- guests_count (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

üí° **–û–ö–ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ = count(PhotoCompany where photographer_id)**

---

### 3.5. Photo (–ö–∞–¥—Ä)

```
Photo
- id
- photo_company_id
- photographer_id
- file_name
- rating (–∑–≤—ë–∑–¥—ã –≤ Lightroom)
- is_selected
```

üìå –ú–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Lightroom:
- –ß–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ß–µ—Ä–µ–∑ —Ä—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç CSV

---

### 3.6. ProductionBatch (–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)

```
ProductionBatch
- id
- photo_company_id
- retoucher_id
- started_at
- finished_at
- quality_score (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

üí° –ú–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å:
- –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—Ç—É—à–∏
- –ù–∞–≥—Ä—É–∑–∫—É
- –£–∑–∫–∏–µ –º–µ—Å—Ç–∞

---

### 3.7. Product (–ü—Ä–æ–¥—É–∫—Ü–∏—è)

```
Product
- id
- name (—Ä–∞–º–∫–∞ 10x15, –º–∞–≥–Ω–∏—Ç)
- category
- cost_price
- sale_price
```

---

### 3.8. Sale (–ü—Ä–æ–¥–∞–∂–∞ / —á–µ–∫)

```
Sale
- id
- sale_datetime
- location_id
- seller_id
- photo_company_id
- total_amount
- payment_type
```

üìå **–°–≤—è–∑—å Sale ‚Üî PhotoCompany ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–∞**

–ë–µ–∑ –Ω–µ—ë –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è.

---

### 3.9. SaleItem (–ü–æ–∑–∏—Ü–∏—è –≤ —á–µ–∫–µ)

```
SaleItem
- id
- sale_id
- product_id
- quantity
- price
```

üí° –ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –ê–Ω–∞–ª–∏–∑ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞
- –ê–ø—Å–µ–ª–ª—ã
- –ö–æ–º–ø–ª–µ–∫—Ç—ã

---

### 3.10. Feedback (–§–∏–¥–±—ç–∫)

```
Feedback
- id
- photo_company_id
- rating
- comment
- source (telegram, admin)
```

üìå –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è:
- –®—Ç—Ä–∞—Ñ–æ–≤
- –ë–æ–Ω—É—Å–æ–≤
- –û–±—É—á–µ–Ω–∏—è

---

### 3.11. PayrollCalc (–†–∞—Å—á—ë—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏)

```
PayrollCalc
- id
- employee_id
- period_start
- period_end
- base_amount
- bonus_amount
- total_amount
- details (json)
```

üí° **–í–°–Ø –ó–ü —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

Google Sheets ‚Üí –≤ –∞—Ä—Ö–∏–≤ üòÑ

---

## 4. –°–í–Ø–ó–ò –ú–ï–ñ–î–£ –°–£–©–ù–û–°–¢–Ø–ú–ò

```
Employee 1‚Äî* Shift
Employee 1‚Äî* PhotoCompany (photographer)
Employee 1‚Äî* ProductionBatch (retoucher)
Employee 1‚Äî* Sale (seller)

PhotoCompany 1‚Äî* Photo
PhotoCompany 1‚Äî1 ProductionBatch
PhotoCompany 0‚Äî1 Sale
Sale 1‚Äî* SaleItem
SaleItem *‚Äî1 Product
```

---

## 5. –†–ê–°–ß–Å–¢ KPI –ò–ó –°–•–ï–ú–´

### üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ

| KPI | –§–æ—Ä–º—É–ª–∞ |
|-----|---------|
| –û–ö–ö | `COUNT(PhotoCompany)` |
| –¶–ö | `SUM(Sale.total_amount) / COUNT(PhotoCompany)` |

### üõí –ü—Ä–æ–¥–∞–≤–µ—Ü

| KPI | –§–æ—Ä–º—É–ª–∞ |
|-----|---------|
| –ö–æ–Ω–≤–µ—Ä—Å–∏—è | `Sold / (Sold + Declined)` |
| –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ | `AVG(Sale.total_amount)` |

### üé® –†–µ—Ç—É—à—ë—Ä

| KPI | –§–æ—Ä–º—É–ª–∞ |
|-----|---------|
| –í—ã—Ä—É—á–∫–∞ | `% –æ—Ç SUM(Sale.total_amount WHERE retoucher_id)` |

---

## 6. –ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **–ï—Å–ª–∏ PhotoCompany –∑–∞–≤–µ–¥–µ–Ω–∞ ‚Äî –¥–µ–Ω—å–≥–∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å –º–æ–∂–Ω–æ**
2. **–ï—Å–ª–∏ –Ω–µ—Ç —Å–≤—è–∑–∏ Sale ‚Üî PhotoCompany ‚Äî –º–æ—Ç–∏–≤–∞—Ü–∏—è –ª–æ–º–∞–µ—Ç—Å—è**
3. –≠—Ç–æ **–Ω–µ —Å–ª–æ–∂–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏**, –Ω–æ **–∫—Ä–∏—Ç–∏—á–Ω–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ**

---

## üìö –ì–õ–û–°–°–ê–†–ò–ô

**Employee** ‚Äî —Å—É—â–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

**Feedback** ‚Äî –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏

**Location** ‚Äî –ª–æ–∫–∞—Ü–∏—è (–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ñ–æ—Ç–æ—Å—ä—ë–º–æ–∫)

**PayrollCalc** ‚Äî —Ä–∞—Å—á—ë—Ç –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏

**Photo** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–¥—Ä –≤ —Ä–∞–º–∫–∞—Ö PhotoCompany

**PhotoCompany** ‚Äî –∫–æ–º–ø–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π, —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

**Product** ‚Äî –ø—Ä–æ–¥—É–∫—Ü–∏—è (—Ä–∞–º–∫–∏, –º–∞–≥–Ω–∏—Ç—ã –∏ —Ç.–¥.)

**ProductionBatch** ‚Äî –ø–∞—Ä—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—á–∞—Ç–∏

**Sale** ‚Äî –ø—Ä–æ–¥–∞–∂–∞ / —á–µ–∫

**SaleItem** ‚Äî –ø–æ–∑–∏—Ü–∏—è –≤ —á–µ–∫–µ –ø—Ä–æ–¥–∞–∂–∏

**Shift** ‚Äî —Ä–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

**–¶–ö (CK)** ‚Äî –¶–µ–Ω–Ω–æ—Å—Ç—å –ö–æ–º–ø–∞–Ω–∏–∏, —Å—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–∞ –æ–¥–Ω—É –∫–æ–º–ø–∞–Ω–∏—é

**–û–ö–ö** ‚Äî –û–±—â–µ–µ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ö–æ–º–ø–∞–Ω–∏–π, –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ–±—ä—ë–º–∞ —Ä–∞–±–æ—Ç—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞

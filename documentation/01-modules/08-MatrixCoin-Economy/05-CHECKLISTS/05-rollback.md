# 05-rollback.md
## Rollback & Safe Reversion — Operational Playbook (MC / GMC)

**Назначение:** Безопасный откат системы MatrixCoin Economy  
**Принцип:** Остановить вред важнее, чем сохранить удобство  
**Ключевое:** Rollback ≠ переписывание истории

---

## 0. Что такое rollback в этой системе

Rollback — это:
- **остановка или ограничение будущих действий**;
- **возврат системы в безопасное состояние**;
- **без изменения прошлого**.

Rollback **НЕ означает**:
- удаление событий;
- пересчёт истории;
- возврат Consumed MC;
- отмену признанных GMC.

История **никогда не откатывается**.

---

## 1. Когда rollback ОБЯЗАТЕЛЕН

Rollback требуется, если:

- система начала восприниматься как деньги или KPI;
- возникло давление или страх у людей;
- обнаружен конфликт audit-данных;
- автоматизация начала принимать решения;
- невозможно однозначно определить корректность состояния.

Если есть сомнение — **rollback нужен**.

---

## 2. Немедленные действия (EMERGENCY STOP)

При решении о rollback **СРАЗУ**:

- [ ] Остановить начисление MC
- [ ] Запретить открытие новых аукционов
- [ ] Заблокировать автоматические сценарии
- [ ] Перевести систему в режим **SAFE** или **READ-ONLY**
- [ ] Зафиксировать событие `SystemRollbackInitiated`

❌ Ничего не пересчитывать  
❌ Ничего не удалять  

---

## 3. Фиксация точки rollback

После остановки:

- [ ] Зафиксировать временную метку rollback
- [ ] Зафиксировать причину
- [ ] Зафиксировать ответственного человека
- [ ] Указать затронутые контуры (MC / GMC / Auctions)

Это **точка отсчёта**, а не точка отката.

---

## 4. Анализ после остановки

### 4.1. Что проверять

- последовательность audit-событий;
- последние начисления MC;
- последние аукционы;
- автоматические цепочки;
- жалобы людей.

---

### 4.2. Что НЕ делать

Запрещено:
- «поправить баланс»;
- компенсировать MC;
- аннулировать GMC;
- делать исключения.

---

## 5. Варианты rollback (ВЫБОР ЧЕЛОВЕКА)

### Вариант A — Мягкий rollback

Используется, если:
- ошибка локальная;
- смысл системы не нарушен.

Действия:
- ограничить проблемный сценарий;
- оставить остальное активным;
- усилить мониторинг.

---

### Вариант B — Жёсткий rollback

Используется, если:
- затронут смысл или этика;
- есть риск давления на людей.

Действия:
- остановить весь контур MC;
- заморозить аукционы;
- оставить систему в SAFE.

---

### Вариант C — Полный rollback

Используется, если:
- CANON нарушен;
- невозможно доверять текущему состоянию.

Действия:
- перевести систему в **INVALID**;
- заблокировать все операции;
- подготовить план восстановления.

---

## 6. Коммуникация при rollback

### Что говорить

- «Система временно ограничена»
- «История данных сохранена»
- «Решение принято для защиты участников»

### Чего не говорить

- «Мы всё откатим»
- «Мы всё исправим задним числом»
- «Вам компенсируют»

---

## 7. Восстановление после rollback

Перед возвратом к работе:

- [ ] Причина rollback устранена
- [ ] Обновлены правила (если нужно)
- [ ] Обновлены чеклисты
- [ ] Проведён dry run
- [ ] Зафиксировано событие `SystemRollbackResolved`

---

## 8. Документирование

Каждый rollback:
- имеет отдельную запись;
- содержит причину;
- содержит принятые решения;
- доступен для последующего анализа.

Rollback без документации считается **архитектурной ошибкой**.

---

## 9. Краткая версия (НА ОДИН ЭКРАН)

1. Стоп начисления  
2. Стоп аукционы  
3. SAFE / READ-ONLY  
4. Ничего не правлю  
5. Анализирую audit  
6. Решаю вручную  

---

## 10. Главное правило

> **Rollback — это признак зрелости системы,  
> а не её слабости.**
